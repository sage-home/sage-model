# Makefile for core physics separation test
# This compiles only the core components and placeholder module, without full SAGE

# Directory setup
TEST_DIR := $(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))
ROOT_DIR := $(shell dirname $(TEST_DIR))
SRC_DIR := $(ROOT_DIR)/src
CORE_DIR := $(SRC_DIR)/core
PHYSICS_DIR := $(SRC_DIR)/physics

# Compiler and flags
CC := clang
CFLAGS := -DROOT_DIR='$(ROOT_DIR)' -DHDF5 -O2 -march=native -std=gnu99 -fPIC -g -Wall
INCLUDES := -I$(ROOT_DIR) -I$(CORE_DIR) -I$(PHYSICS_DIR) -I/opt/homebrew/include

# Core and test source files
CORE_SRC := \
	$(CORE_DIR)/core_logging.c \
	$(CORE_DIR)/core_module_system.c \
	$(CORE_DIR)/core_galaxy_extensions.c \
	$(CORE_DIR)/core_event_system.c \
	$(CORE_DIR)/core_pipeline_system.c \
	$(CORE_DIR)/core_module_callback.c \
	$(CORE_DIR)/physics_pipeline_executor.c \
	$(PHYSICS_DIR)/placeholder_empty_module.c \
	$(CORE_DIR)/core_properties.c \
	$(CORE_DIR)/core_properties_sync.c \
	$(CORE_DIR)/standard_properties.c \
	$(CORE_DIR)/core_galaxy_accessors.c

TEST_SRC := test_core_physics_separation.c

# Output target
TEST_EXEC := test_core_physics_separation

# Default target
all: $(TEST_EXEC)

# Run the test
run: $(TEST_EXEC)
	@echo "Running core physics separation test..."
	@./$(TEST_EXEC)

# Compile the test executable
$(TEST_EXEC): $(TEST_SRC) $(CORE_SRC)
	@echo "Compiling core physics separation test..."
	@$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^

# Clean up
clean:
	@echo "Cleaning up core physics separation test..."
	@rm -f $(TEST_EXEC)

.PHONY: all run clean
